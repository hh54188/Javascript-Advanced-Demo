
<!DOCTYPE html>
<html>
	<head></head>
	<!--core-->
	<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/ckeditor.js"></script>
	<script type="text/javascript" src="js/adapters/jquery.js"></script>
	<!--UI-->
	<script type="text/javascript" src="js/jquery-ui-1.8.21.custom.min.js"></script>
	<link rel="stylesheet" href="css/smoothness/jquery-ui-1.8.18.custom.css">
	<!--html2canvas-->
	<script type="text/javascript" src="js/html2canvas/html2canvas.min.js"></script>
	<script type="text/javascript" src="js/html2canvas/jquery.plugin.html2canvas.js"></script>
	<style type="text/css">
		#drag {
			border: 5px solid black;
			width: 600px;
			height: 600px;
		}
		iframe {
			width: 100%;
			height: 100%;
		}
		#test-img {
			position: absolute;
			left: 0;
			bottom: 0;
			border: 1px gray solid;
		}
	</style>
	<script type="text/javascript">
		$(function () {
			var config = {
				// font_names:"",
				resize_minWidth: 500,
				resize_enabled: true,
				// autoGrow_maxHeight: 500,
				autoGrow_onStartup: true,
				skin:'kama'
			};

			$('#ckeditor').ckeditor(config).ckeditor(function () {
				// $('#cke_ckeditor').draggable();
			});
			
			//screen shot
			$('#screen-shot').click(function () {
				var size = $('#cke_ckeditor'), width = parseInt(size.css('width')), height = parseInt(size.css('height'));
				var content = $('#cke_ckeditor iframe').contents().find('.cke_show_borders').clone();

				//new window
				// var test = window.open("iframe.html", '_blank' ,"height=" + height + ", width=" + width);
				// test.onload = function () {
				// 	var body = $(test.document.body);
				// 	body.find('#container').prepend(content.html());
				// };

				//inner iframe;
				var frame = $('#img-iframe');
				frame.contents().find('.screenShot').remove();
				frame.contents().find('body').css({
					width: width + "px",
					height: height + "px"
				}).end().find('#container').add('#count-down').show().empty().prepend(content.html());

				var screenshot = window.frames["testFrame"].screenshot;
				screenshot();
			})

			window.setImgSrc = function (src) {
				$('#test-img').attr('src', src)
			}

			//drag:
			$( "#drag" ).resizable({
				minWidth: 500
			}).draggable();

			//edit again:
			$('#edit-again').click(function () {
				var sample = $('<p><span style="font-size:72px;"><span style="color:#0000cd;"><span style="background-color:#ffff00;">asdasd</span><span style="background-color: rgb(255, 255, 0); ">asdasd</span><span style="background-color: rgb(255, 255, 0); ">as</span></span><span style="background-color:#00ff00;">dasdasdasd</span></span></p>');

				var sampleWidth = 600;
				var sampleHeight = 600;
				$('#cke_ckeditor').find('iframe').contents().find('body').empty().prepend(sample);
				$('#cke_ckeditor').css({
					width: sampleWidth + "px",
					height: sampleHeight + "px"
				});

			})
		})
	</script>
	<body>
		<button id="screen-shot">截屏</button>
		<button id="edit-again">再编辑</button>
		<!-- <div id="drag"> -->
			<textarea id="ckeditor"  class="ckeditor" name="editor1"></textarea>
		<!-- </div> -->
		<iframe style="opacity:0;" name="testFrame" id="img-iframe" src="iframe.html"></iframe>
		<img id="test-img" src="">
	</body>
</html>
<script type="text/javascript">
	$('#cke_ckeditor').draggable();
</script>
