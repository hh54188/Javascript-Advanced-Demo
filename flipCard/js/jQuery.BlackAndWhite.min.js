(function(a){a.fn.extend({BlackAndWhite:function(c){function i(f,b,d,l){var g=b.getContext("2d"),e=0,c;a(f).load(function(){g.drawImage(f,0,0);var a=g.getImageData(0,0,d,l),b=a.data,h=b.length;if(m&&j)try{var k=new Worker(j+"BnWWorker.js");k.onmessage=function(b){a.data=b.data;g.putImageData(b.data,0,0)};k.postMessage(a)}catch(i){console.log(i)}else{for(;e<h;e+=4)c=0.3*b[e]+0.59*b[e+1]+0.11*b[e+2],b[e]=b[e+1]=b[e+2]=c;g.putImageData(a,0,0)}})}var f=this,c=a.extend({hoverEffect:!0,webworkerPath:!1}, c),h=c.hoverEffect,j=c.webworkerPath,n=!!document.createElement("canvas").getContext,m=function(){return"undefined"!==typeof Worker?!0:!1};this.init=function(){n&&!(jQuery.browser.msie&&"9.0"==jQuery.browser.version)?(a(f).each(function(f,b){var d=a(b).find("img"),c=a(d).prop("src"),g=a(d).prop("width"),e=a(d).prop("height");if(jQuery.browser.opera){var h=Math.random();a(d).prop("src",c+"?"+h)}(!g||!e)&&alert("Set the width and height on your images");a('<canvas width="'+g+'" height="'+e+'"></canvas>').prependTo(b); c=a(b).find("canvas");a(c).css({position:"absolute",top:0,left:0});i(d[0],c[0],g,e)}),h&&(a(f).mouseenter(function(){a(this).find("canvas").stop(!0,!0).fadeOut()}),a(f).mouseleave(function(){a(this).find("canvas").stop(!0,!0).fadeIn()}))):(a(f).each(function(c,b){var d=a(b).find("img"),f=a(b).find("img").prop("src"),g=a(d).prop("width"),d=a(d).prop("height");(!g||!d)&&alert("Set the width and height on your images");a("<img src="+f+' width="'+g+'" height="'+d+'" class="ieFix" /> ').prependTo(b);a(".ieFix").css({position:"absolute", top:0,left:0,filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"})}),h&&(a(f).mouseenter(function(){a(this).children(".ieFix").stop(!0,!0).fadeOut()}),a(f).mouseleave(function(){a(this).children(".ieFix").stop(!0,!0).fadeIn()})))};return this.init(c)}})})(jQuery);